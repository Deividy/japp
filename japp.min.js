!function(){var a={errorHander:function(a,b){alert(b),window.location.reload(!0)}};JA=window.JA={initialized:!1,build:function(a){if(this.initialized)throw new Error("JA is already initialized");a||(a={});var c=new b(a);_.extend(this,c),this.initialized=!0},inherit:function(a,b){function c(){this.constructor=a.constructor}c.prototype=b.prototype;for(var d in b)Object.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a.prototype=new c,a}};var b=function(b){_.extend(this,Backbone.Events),_.extend(this,b),_.defaults(this,a),this._activePage=null,this._pages=[],this._pageById={},this.routes={}};_.extend(b.prototype,{createRoutesForPages:function(){var a=this;_.each(this._pages,function(b){b.isRoute&&!a.routes[b.id]&&(a.routes[b.id]=function(){a.navigate(b.id)})})},startRouter:function(){this.createRoutesForPages();var a=Backbone.Router.extend({routes:this.routes});this.router=new a,Backbone.history.start()},addPage:function(a){F.demandGoodObject(a,"pageObj");var b=new JA.Page(a);return this._pages.push(b),this._pageById[b.id]=b,b},page:function(a){F.demandGoodString(a,"pageId");var b=this._pageById[a];if(b)return b;throw new Error("Page "+a+" not found!")},activePage:function(){return this._activePage||{id:void 0}},navigate:function(a){if(F.demandGoodString(a,"pageId"),JA.activePage().id!==a){var b=null;if(_.each(this._pages,function(c){return c.id!==a&&this.activePage().id===c.id?c.deactivate():void(c.id===a&&(c.activate(),b=c))},this),null===b)throw new Error("Page "+a+" not found");this._activePage=b}},get:function(a,b,c){_.isFunction(b)&&(c=b,b={}),F.demandGoodString(a,"url"),F.demandObject(b,"data"),F.demandFunction(c,"callback"),$.ajax({type:"GET",url:a,data:b,success:c,error:this.errorHandler,cache:!1})},post:function(a,b,c){_.isFunction(b)&&(c=b,b={}),F.demandGoodString(a,"url"),F.demandObject(b,"data"),F.demandFunction(c,"callback"),$.ajax({type:"POST",url:a,data:b,success:c,error:this.errorHandler})}}),JA.JApp=b}(),function(){var a={afterDeactivate:function(){},beforeDeactivate:function(a){a()},afterActivate:function(){},beforeActivate:function(a){a()},render:function(){return this.$container.html(this.template()),this},template:function(){return _.template($(this.templateSelector).html())}},b=["setElement","remove","delegateEvents","undelegateEvents"];JA.Display=function(b){F.demandGoodObject(b,"options"),F.demandGoodString(b.id,"options.id"),F.demandGoodString(b.container,"options.container"),_.extend(this,b),_.defaults(this,a),this.selector||(this.selector=this.container),this.$container=$(this.container),this.render(),this.$el=this.$(),this.delegateEvents(this.events)},_.extend(JA.Display.prototype,{$:function(){return $(this.selector)},activate:function(){var a=this;this.beforeActivate(function(){a.show(),a.afterActivate()})},deactivate:function(){var a=this;this.beforeDeactivate(function(){a.hide(),a.afterDeactivate()})},hide:function(){this.$().hide()},show:function(){this.$().show()}}),_.extend(JA.Display.prototype,_.pick(Backbone.View.prototype,b))}(),function(){var a={isRoute:!0,afterDeactivate:function(){},beforeDeactivate:function(a){a()},afterActivate:function(){},beforeActivate:function(a){a()}};JA.Page=function(b){F.demandGoodObject(b,"options"),F.demandGoodString(b.id,"options.id"),_.extend(this,Backbone.Events),_.extend(this,b),_.defaults(this,a),this._activeDisplay=null,this._displays=[],this._displayById={}},_.extend(JA.Page.prototype,{display:function(a){F.demandGoodString(a,"displayId");var b=this._displayById[a];if(b)return b;throw new Error("Display "+a+" not found!")},addDisplay:function(a){F.demandGoodObject(a,"displayObj");var b=new JA.Display(a);return this._displays.push(b),this._displayById[b.id]=b,b.hide(),b},activateAllDisplays:function(){_.each(this._displays,function(a){a.activate()})},deactivateAllDisplays:function(){_.each(this._displays,function(a){a.deactivate()})},activate:function(){var a=this;this.beforeActivate(function(){a.activateAllDisplays(),a.afterActivate()})},deactivate:function(){var a=this;this.beforeDeactivate(function(){a.deactivateAllDisplays(),a.afterDeactivate()})}})}();