!function(){var a={errorHandler:function(a,b){alert(b),window.location.reload(!0)},loading:{show:function(){},hide:function(){}}};JA=window.JA={initialized:!1,build:function(a){if(this.initialized)throw new Error("JA is already initialized");a||(a={});var c=new b(a);_.extend(this,c),this.initialized=!0},inherit:function(a,b){function c(){this.constructor=a.constructor}c.prototype=b.prototype;for(var d in b)Object.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a.prototype=new c,a}};var b=function(b){this.routes={},_.extend(this,Backbone.Events),_.extend(this,b),_.defaults(this,a),this._activePage=null,this._pages=[],this._pageById={},this.runningTasks=[]};_.extend(b.prototype,{createRoutesForPages:function(){var a=this;_.each(this._pages,function(b){b.isRoute&&!a.routes[b.id]&&(a.routes[b.id]=function(){a.navigate(b.id)})})},startRouter:function(){this.createRoutesForPages();var a=Backbone.Router.extend({routes:this.routes});this.router=new a,Backbone.history.start()},addPage:function(a){ArgumentValidator.object(a,"pageObj");var b=new JA.Page(a);return this._pages.push(b),this._pageById[b.id]=b,b},page:function(a){ArgumentValidator.string(a,"pageId");var b=this._pageById[a];if(b)return b;throw new Error("Page "+a+" not found!")},activePage:function(){return this._activePage||{id:void 0}},navigate:function(a){if(ArgumentValidator.string(a,"pageId"),JA.activePage().id!==a){var b=null;if(_.each(this._pages,function(c){return c.id!==a&&this.activePage().id===c.id?c.deactivate():void(c.id===a&&(c.activate(),b=c))},this),null===b)throw new Error("Page "+a+" not found");this._activePage=b}},get:function(a,b,c){_.isFunction(b)&&(c=b,b={}),ArgumentValidator.string(a,"url"),ArgumentValidator.objectOrEmpty(b,"data"),ArgumentValidator.type("Function",c,"callback"),this.loading.show();var d={method:"get",url:a,data:b,callback:c},e=this.runningTasks.push(d);return $.ajax({type:"GET",url:a,data:b,success:_.bind(function(){this.runningTasks.splice(e-1,1),0===this.runningTasks.length&&this.loading.hide(),c.apply(this,arguments)},this),error:_.bind(this.errorHandler,this),cache:!1})},post:function(a,b,c){_.isFunction(b)&&(c=b,b={}),ArgumentValidator.string(a,"url"),ArgumentValidator.objectOrEmpty(b,"data"),ArgumentValidator.type("Function",c,"callback"),this.loading.show();var d={method:"post",url:a,data:b,callback:c},e=this.runningTasks.push(d);return $.ajax({type:"POST",url:a,data:b,success:_.bind(function(){this.runningTasks.splice(e-1,1),0===this.runningTasks.length&&this.loading.hide(),c.apply(this,arguments)},this),error:_.bind(this.errorHandler)})}})}(),function(){var a={afterDeactivate:function(){},beforeDeactivate:function(a){a()},afterActivate:function(){},beforeActivate:function(a){a()}},b=["setElement","remove","delegateEvents","undelegateEvents"];JA.Display=function(b){ArgumentValidator.keysWithString(b,["id","container"],"options"),_.extend(this,b),_.defaults(this,a),this.selector||(this.selector=this.container),this.$container=$(this.container),this.$el=this.$(),this.delegateEvents(this.events),this.isActive=!1},_.extend(JA.Display.prototype,{$:function(){return $(this.selector)},activate:function(){var a=this;this.beforeActivate(function(){a.isActive=!0,a.show(),a.afterActivate()})},deactivate:function(){var a=this;this.beforeDeactivate(function(){a.isActive=!1,a.hide(),a.afterDeactivate()})},hide:function(){this.$().hide()},show:function(){this.$().show()}}),_.extend(JA.Display.prototype,_.pick(Backbone.View.prototype,b))}(),function(){var a={isRoute:!0,afterDeactivate:function(){},beforeDeactivate:function(a){a()},afterActivate:function(){},beforeActivate:function(a){a()}};JA.Page=function(b){ArgumentValidator.keysWithString(b,["id"],"options"),_.extend(this,Backbone.Events),_.extend(this,b),_.defaults(this,a),this._activeDisplay=null,this._displays=[],this._displayById={}},_.extend(JA.Page.prototype,{display:function(a){ArgumentValidator.string(a,"displayId");var b=this._displayById[a];if(b)return b;throw new Error("Display "+a+" not found!")},addDisplay:function(a){ArgumentValidator.object(a,"displayObj");var b=new JA.Display(a);return this._displays.push(b),this._displayById[b.id]=b,b.hide(),b},activateAllDisplays:function(){_.each(this._displays,function(a){a.isActive||a.activate()})},deactivateAllDisplays:function(){_.each(this._displays,function(a){a.isActive&&a.deactivate()})},activate:function(){var a=this;this.beforeActivate(function(){a.activateAllDisplays(),a.afterActivate()})},deactivate:function(){var a=this;this.beforeDeactivate(function(){a.deactivateAllDisplays(),a.afterDeactivate()})}})}();